#!/usr/bin/env python3

"""
    Usage:
        - ./bin/env-to-json parse_json
        - ./bin/env-to-json
"""

import json
import os
import sys


class EnvToJson:
    def main(self, parse_json: bool):
        env = dict(os.environ)
        to_serialize = {}

        for name, value in env.items():
            if parse_json:
                try:
                    value = json.loads(value)
                except json.JSONDecodeError:
                    pass

            to_serialize[name] = value

        print(json.dumps(to_serialize))


if __name__ == '__main__':
    EnvToJson().main(sys.argv[1] == 'parse_json' if len(sys.argv) > 1 else '')
